<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏆 호기심 자랑대회 - 자연 질문하기</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🏆</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-green-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        
        <!-- 자연 이미지 헤더 -->
        <div id="natureHeader" class="relative mb-8 rounded-lg overflow-hidden shadow-lg">
            <div class="h-64 bg-cover bg-center bg-no-repeat" id="natureImage">
                <div class="absolute inset-0 bg-black bg-opacity-30"></div>
                <div class="relative z-10 flex items-center justify-center h-full text-center">
                    <div>
                        <h1 class="text-5xl font-bold text-white mb-2 drop-shadow-lg">🤔 호기심 자랑대회 🏆</h1>
                        <h2 class="text-4xl font-bold text-white drop-shadow-lg">자연을 보며 궁금한 점을 적어보세요</h2>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <div id="currentTime" class="text-lg font-medium text-gray-700 bg-white bg-opacity-80 rounded-lg py-2 px-4 inline-block"></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- 왼쪽: 질문 입력 섹션 -->
            <div class="space-y-6">
                
                <!-- 질문 입력 카드 -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="mb-4">
                        <label class="block text-lg font-semibold text-gray-700 mb-2">
                            자연에서 궁금한 것
                        </label>
                        <textarea 
                            id="question1" 
                            placeholder="예: 나뭇잎은 왜 초록색일까요?"
                            class="w-full p-3 border-2 border-blue-200 rounded-lg focus:border-blue-400 focus:outline-none resize-none"
                            rows="3"
                        ></textarea>
                    </div>
                    
                    <button 
                        onclick="startTwentyQuestions()" 
                        class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors font-medium"
                    >
                        스무고개로 깊이 탐구하기!
                    </button>
                </div>

                <!-- 연구 참여 안내 -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-green-800 mb-3">스무고개 탐구란?</h3>
                    <p class="text-sm text-green-700 mb-4">
                        당신의 질문에서 시작해서 AI와 함께 20번의 질문을 주고받으며 
                        자연의 비밀을 하나씩 풀어가는 탐구 여행입니다.
                    </p>
                    <div class="text-xs text-green-600">
                        💡 홀수 번째: 당신이 질문 <br>
                        💡 짝수 번째: AI가 5가지 선택지 제시
                    </div>
                </div>

                <!-- 내가 쓴 질문들 -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h3 class="font-semibold text-yellow-800 mb-2">내가 쓴 질문들</h3>
                    <div id="myQuestions" class="text-sm text-yellow-700">
                        아직 질문을 쓰지 않았어요
                    </div>
                </div>

            </div>

            <!-- 오른쪽: 통계 및 워드클라우드 -->
            <div class="space-y-6">
                
                <!-- 실시간 통계 -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">지금까지의 탐구들</h3>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <div id="weekCount" class="text-2xl font-bold text-green-600">0</div>
                            <div class="text-sm text-green-600">최근 1주일</div>
                        </div>
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <div id="totalCount" class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-sm text-blue-600">전체 탐구 수</div>
                        </div>
                    </div>

                    <div id="popularTopics" class="text-sm text-gray-600">
                        <strong>인기 주제:</strong> 데이터를 불러오는 중...
                    </div>
                </div>

                <!-- 최근 탐구 주제들 -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">최근 탐구 주제들</h3>
                    <div id="recentTopics" class="space-y-2 text-sm">
                        <div class="p-2 bg-gray-50 rounded text-gray-600">
                            데이터를 불러오는 중...
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- 푸터 -->
        <div class="mt-12 text-center text-gray-600 space-y-2">
            <p class="text-lg font-semibold">자연과 함께하는 탐구</p>
            <p class="text-sm">모든 질문에서 누가 쓴 것인지는 표시되지 않아요</p>
            <p class="text-xs text-gray-500 mt-4">© 2025 Made by Claude & PIO. All rights reserved.</p>
        </div>

    </div>

    <script>
        // Supabase 연결 설정
        const supabaseUrl = 'https://kcaxstyuejaecdaafijy.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjYXhzdHl1ZWphZWNkYWFmaWp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExNzIwNjYsImV4cCI6MjA2Njc0ODA2Nn0.V__xaHzg5hbt2GpIBH1I4CegLx5Fp33cya-Jl93b6hE';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // 자연 이미지 배열
        const natureImages = [
            'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80',
            'https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'
        ];

        // 랜덤 자연 이미지 설정
        function setRandomNatureImage() {
            const randomIndex = Math.floor(Math.random() * natureImages.length);
            const imageUrl = natureImages[randomIndex];
            document.getElementById('natureImage').style.backgroundImage = `url('${imageUrl}')`;
        }

        // 현재 시간 표시
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // 로컬스토리지에서 내 질문들 불러오기
        function loadMyQuestions() {
            const myQuestions = JSON.parse(localStorage.getItem('myQuestions') || '[]');
            const myQuestionsDiv = document.getElementById('myQuestions');
            
            if (myQuestions.length === 0) {
                myQuestionsDiv.innerHTML = '아직 질문을 쓰지 않았어요';
            } else {
                myQuestionsDiv.innerHTML = myQuestions
                    .slice(-3)
                    .map(q => `<div class="mb-1">• ${q.substring(0, 30)}${q.length > 30 ? '...' : ''}</div>`)
                    .join('');
            }
        }

        // 스무고개 시작
        function startTwentyQuestions() {
            const question = document.getElementById('question1').value.trim();
            
            if (!question) {
                alert('질문을 입력해주세요.');
                return;
            }

            // 로컬스토리지에 내 질문 저장
            const myQuestions = JSON.parse(localStorage.getItem('myQuestions') || '[]');
            myQuestions.push(question);
            localStorage.setItem('myQuestions', JSON.stringify(myQuestions));

            // URL 인코딩해서 game.html로 이동
            const encodedQuestion = encodeURIComponent(question);
            window.location.href = `game.html?q=${encodedQuestion}`;
        }

        // 통계 데이터 로드
        async function loadStatistics() {
            try {
                // 전체 세션 수
                const { count: totalCount } = await supabase
                    .from('exploration_sessions')
                    .select('*', { count: 'exact', head: true });

                // 최근 1주일 세션 수
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                const { count: weekCount } = await supabase
                    .from('exploration_sessions')
                    .select('*', { count: 'exact', head: true })
                    .gte('created_at', oneWeekAgo.toISOString());

                document.getElementById('totalCount').textContent = totalCount || 0;
                document.getElementById('weekCount').textContent = weekCount || 0;

                // 최근 탐구 주제들 로드
                const { data: recentSessions } = await supabase
                    .from('exploration_sessions')
                    .select('initial_question')
                    .order('created_at', { ascending: false })
                    .limit(5);

                if (recentSessions && recentSessions.length > 0) {
                    document.getElementById('recentTopics').innerHTML = recentSessions
                        .map(session => `<div class="p-2 bg-gray-50 rounded text-gray-600">${session.initial_question}</div>`)
                        .join('');
                }

            } catch (error) {
                console.error('통계 로드 오류:', error);
            }
        }

        // 페이지 로드 시 초기화
        window.onload = function() {
            setRandomNatureImage();
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000);
            loadMyQuestions();
            loadStatistics();
        };
    </script>
</body>
</html>
